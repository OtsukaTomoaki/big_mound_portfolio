# プロンプト作成機能 ドキュメント

## 1. 機能概要

プロンプト作成機能は、ユーザーが新しいAIプロンプトを作成し、Supabaseデータベースに保存するための機能です。ユーザーはタイトル、説明（オプション）、プロンプト本文、使用するAIモデルを入力できます。

### 主な特徴

- 直感的なフォームインターフェース
- リアルタイムバリデーション
- 複数のAIモデル対応
- レスポンシブデザイン
- エラーハンドリング

## 2. 使用方法

### ユーザーフロー

1. トップページの「Forge New Prompt」ボタンをクリック
2. プロンプト作成フォームに必要事項を入力
   - タイトル（必須、1-100文字）
   - 説明（任意、最大300文字）
   - プロンプト本文（必須、1-4000文字）
   - モデル（必須、ドロップダウンから選択）
3. 「保存する」ボタンをクリック
4. 成功時：トップページにリダイレクト
   失敗時：エラーメッセージを表示

### スクリーンショット

（ここにスクリーンショットを追加）

## 3. 技術的な実装詳細

### コンポーネント構成

- `pages/create.vue` - プロンプト作成ページのメインコンポーネント
- `components/ui/button.vue` - ボタンコンポーネント
- `composables/usePromptValidation.ts` - プロンプトバリデーションロジック

### データフロー

1. ユーザー入力 → フォームバリデーション
2. 送信ボタンクリック → Supabase APIへのデータ送信
3. 成功時 → トップページへリダイレクト
4. 失敗時 → エラーメッセージ表示

### データモデル

プロンプトデータは以下の構造でSupabaseの`prompts`テーブルに保存されます：

| カラム名    | 型        | 必須 | 説明                                   |
| :---------- | :-------- | :--- | :------------------------------------- |
| id          | uuid      | ✅   | プロンプトID（主キー）                 |
| title       | text      | ✅   | タイトル                               |
| description | text      | ❌   | 概要説明                               |
| prompt_text | text      | ✅   | プロンプト本文                         |
| model       | text      | ✅   | 使用するモデル名                       |
| user_id     | uuid      | ✅   | Supabase `auth.users` に紐付く作成者ID |
| tags        | text[]    | ❌   | プロンプトに関連するタグの配列         |
| created_at  | timestamp | ✅   | 作成日時                               |

### セキュリティ

プロンプトデータはRow Level Security (RLS)によって保護されています：

- ユーザーは自分が作成したプロンプトのみ閲覧・編集・削除できます
- 以下のRLSポリシーが実装されています：
  - 閲覧: `Users can view their own prompts`
  - 挿入: `Users can insert their own prompts`
  - 更新: `Users can update their own prompts`
  - 削除: `Users can delete their own prompts`

### バリデーションルール

以下のバリデーションルールが`composables/usePromptValidation.ts`に実装されています：

- タイトル：必須、1-100文字
- 説明：任意、最大300文字
- プロンプト本文：必須、1-4000文字
- モデル：必須、予め定義されたリストから選択

バリデーションロジックはコンポジションAPIとして分離され、再利用可能な形で実装されています。

### 環境による動作の違い

- 開発環境（`NODE_ENV === 'development'`）：

  - 自動的に最初のモデルが選択される
  - Supabaseへの接続をモックし、コンソールにデータを出力
  - 1秒後にトップページへリダイレクト

- 本番環境：
  - Supabaseの認証情報を取得
  - `prompts`テーブルにデータを挿入
  - 成功時はトップページへリダイレクト
  - 失敗時はエラーメッセージを表示

## 4. 注意点・制限事項

- 現在のバリデーションは、クライアントサイドのみで行われています
- プロンプト本文の最大文字数は4000文字に制限されています
- 開発環境では、実際のデータベース保存は行われません
